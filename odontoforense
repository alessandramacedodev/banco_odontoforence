CREATE DATABASE odontoforense;
USE odontoforense;

-- Usuários
CREATE TABLE User (
    id VARCHAR(255) PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    senha VARCHAR(255) NOT NULL,
    role ENUM('Admin', 'Perito', 'Assistente') NOT NULL,
    INDEX (email)
);

-- Casos
CREATE TABLE Caso (
    id VARCHAR(255) PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    descricao TEXT NOT NULL,
    status VARCHAR(50) NOT NULL,
    dataAbertura DATE NOT NULL,
    dataFechamento DATE
);

-- Relacionamento caso ↔ perito
CREATE TABLE Caso_Perito (
    caso_id VARCHAR(255),
    perito_id VARCHAR(255),
    PRIMARY KEY (caso_id, perito_id),
    FOREIGN KEY (caso_id) REFERENCES Caso(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (perito_id) REFERENCES User(id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Evidência unificada
CREATE TABLE Evidence (
    id VARCHAR(255) PRIMARY KEY,
    tipo VARCHAR(50) NOT NULL,
    dataColeta DATE NOT NULL,
    coletadoPor VARCHAR(255) NOT NULL,
    casoId VARCHAR(255) NOT NULL,
    conteudoTexto TEXT,
    imagemURL TEXT,
    FOREIGN KEY (coletadoPor) REFERENCES User(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (casoId) REFERENCES Caso(id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Relatórios
CREATE TABLE Relatorio (
    id VARCHAR(255) PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    conteudo TEXT NOT NULL,
    dataCriacao DATE NOT NULL,
    peritoResponsavel VARCHAR(255) NOT NULL,
    caso_id VARCHAR(255) NOT NULL,
    FOREIGN KEY (peritoResponsavel) REFERENCES User(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (caso_id) REFERENCES Caso(id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Laudos
CREATE TABLE Laudo (
    id VARCHAR(255) PRIMARY KEY,
    resultado VARCHAR(255) NOT NULL,
    precisao FLOAT NOT NULL,
    dataAnalise DATE NOT NULL,
    analisadoPor VARCHAR(255) NOT NULL,
    evidenciaId VARCHAR(255) NOT NULL,
    FOREIGN KEY (analisadoPor) REFERENCES User(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (evidenciaId) REFERENCES Evidence(id) ON DELETE CASCADE ON UPDATE CASCADE
);
