-- Recriar tabela users
DROP TABLE IF EXISTS users CASCADE;
CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT NOT NULL UNIQUE,
  password TEXT NOT NULL,
  role TEXT NOT NULL DEFAULT 'perito' CHECK (role IN ('admin', 'perito', 'assistente'))
);

-- Recriar tabela cases
DROP TABLE IF EXISTS cases CASCADE;
CREATE TABLE cases (
  id INTEGER PRIMARY KEY,
  title TEXT NOT NULL,
  description TEXT,
  local TEXT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  status TEXT NOT NULL DEFAULT 'pendente' CHECK (status IN ('pendente', 'em andamento', 'conclu√≠do')),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Recriar tabela evidences
DROP TABLE IF EXISTS evidences CASCADE;
CREATE TABLE evidences (
  id INTEGER PRIMARY KEY,
  description TEXT NOT NULL,
  type TEXT NOT NULL DEFAULT 'outro' CHECK (type IN ('imagem', 'documento', 'objeto', 'outro')),
  case_id INTEGER NOT NULL REFERENCES cases(id),
  arquivo TEXT,
  cadastrado_por INTEGER NOT NULL REFERENCES users(id),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Recriar tabela laudos
DROP TABLE IF EXISTS laudos CASCADE;
CREATE TABLE laudos (
  id INTEGER PRIMARY KEY,
  evidence_id INTEGER NOT NULL REFERENCES evidences(id),
  conteudo TEXT NOT NULL,
  data_emissao TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  responsavel INTEGER NOT NULL REFERENCES users(id),
  file_path TEXT NOT NULL
);

-- Recriar tabela banco_odonto_legal
DROP TABLE IF EXISTS banco_odonto_legal CASCADE;
CREATE TABLE banco_odonto_legal (
  id INTEGER PRIMARY KEY,
  nome TEXT NOT NULL,
  idade INTEGER NOT NULL,
  genero TEXT NOT NULL,
  identificadores_odonto TEXT,
  observacoes TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Recriar tabela configuracoes
DROP TABLE IF EXISTS configuracoes CASCADE;
CREATE TABLE configuracoes (
  id INTEGER PRIMARY KEY,
  chave TEXT NOT NULL UNIQUE,
  valor JSONB,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
