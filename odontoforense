-- Tabela de usuários
DROP TABLE IF EXISTS users CASCADE;
CREATE TABLE users (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name TEXT NOT NULL,
  login TEXT NOT NULL UNIQUE,
  email TEXT NOT NULL UNIQUE,
  password TEXT NOT NULL UNIQUE,
  role TEXT NOT NULL DEFAULT 'perito' CHECK (role IN ('admin', 'perito', 'assistente'))
);

-- Tabela de casos
DROP TABLE IF EXISTS cases CASCADE;
CREATE TABLE cases (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  title TEXT NOT NULL,
  description TEXT,
  local TEXT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  status TEXT NOT NULL DEFAULT 'pendente' CHECK (status IN ('pendente', 'em andamento', 'concluído')),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de evidências
DROP TABLE IF EXISTS evidences CASCADE;
CREATE TABLE evidences (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  description TEXT NOT NULL,
  type TEXT NOT NULL DEFAULT 'outro' CHECK (type IN ('imagem', 'documento', 'objeto', 'outro')),
  case_id INTEGER NOT NULL REFERENCES cases(id),
  arquivo TEXT,
  cadastrado_por INTEGER NOT NULL REFERENCES users(id),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de laudos
DROP TABLE IF EXISTS laudos CASCADE;
CREATE TABLE laudos (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  evidence_id INTEGER NOT NULL REFERENCES evidences(id),
  conteudo TEXT NOT NULL,
  data_emissao TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  responsavel INTEGER NOT NULL REFERENCES users(id),
  file_path TEXT NOT NULL
);

-- Tabela de banco odonto-legal
DROP TABLE IF EXISTS banco_odonto_legal CASCADE;
CREATE TABLE banco_odonto_legal (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  nome TEXT NOT NULL,
  idade INTEGER NOT NULL,
  genero TEXT NOT NULL,
  identificadores_odonto TEXT,
  observacoes TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de configurações
DROP TABLE IF EXISTS configuracoes CASCADE;
CREATE TABLE configuracoes (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  chave TEXT NOT NULL UNIQUE,
  valor JSONB,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);


-- ==============================
-- INSERÇÕES INICIAIS
-- ==============================

-- Inserir usuários
INSERT INTO users (name, login, email, password, role) VALUES
  ('Ana Costa', 'ana.costa', 'ana.costa@example.com', 'senha123a', 'admin'),
  ('Bruno Lima', 'bruno.lima', 'bruno.lima@example.com', 'senha123b', 'perito'),
  ('Carla Mendes', 'carla.mendes', 'carla.mendes@example.com', 'senha123c', 'assistente'),
  ('Diego Nunes', 'diego.nunes', 'diego.nunes@example.com', 'senha123d', 'perito'),
  ('Elaine Rocha', 'elaine.rocha', 'elaine.rocha@example.com', 'senha123e', 'assistente');

-- Inserir casos
INSERT INTO cases (title, description, local, user_id, status) VALUES
  ('Caso 1', 'Corpo encontrado em área urbana', 'São Paulo - SP', 2, 'pendente'),
  ('Caso 2', 'Acidente de carro com vítima fatal', 'Curitiba - PR', 2, 'em andamento'),
  ('Caso 3', 'Restos mortais em área rural', 'Goiânia - GO', 4, 'concluído'),
  ('Caso 4', 'Crânio encontrado no rio', 'Manaus - AM', 4, 'pendente'),
  ('Caso 5', 'Vítima de incêndio residencial', 'Belo Horizonte - MG', 2, 'em andamento');

-- Inserir evidências
INSERT INTO evidences (description, type, case_id, arquivo, cadastrado_por) VALUES
  ('Foto da arcada dentária', 'imagem', 1, 'foto_arcada.jpg', 3),
  ('Documento com histórico odontológico', 'documento', 2, 'historico.pdf', 3),
  ('Dente molar encontrado', 'objeto', 3, 'dente_molar.png', 5),
  ('Imagem do crânio', 'imagem', 4, 'cranio.jpg', 5),
  ('Outro objeto carbonizado', 'outro', 5, 'objeto_carbonizado.jpg', 3);

-- Inserir laudos
INSERT INTO laudos (evidence_id, conteudo, responsavel, file_path) VALUES
  (1, 'Laudo preliminar da arcada dentária.', 2, 'laudos/laudo1.pdf'),
  (2, 'Análise do histórico odontológico.', 2, 'laudos/laudo2.pdf'),
  (3, 'Identificação com base no dente molar.', 4, 'laudos/laudo3.pdf'),
  (4, 'Avaliação do crânio encontrado.', 4, 'laudos/laudo4.pdf'),
  (5, 'Análise de objeto carbonizado.', 2, 'laudos/laudo5.pdf');

-- Inserir dados no banco odonto-legal
INSERT INTO banco_odonto_legal (nome, idade, genero, identificadores_odonto, observacoes) VALUES
  ('João Silva', 34, 'Masculino', 'Prótese superior completa', 'Suspeita de ser a vítima do Caso 1'),
  ('Maria Souza', 28, 'Feminino', 'Dente canino com ouro', 'Parente confirmou características'),
  ('Carlos Oliveira', 45, 'Masculino', 'Ausência do segundo molar inferior esquerdo', 'Suspeito de Caso 3'),
  ('Luciana Dias', 31, 'Feminino', 'Implante dentário frontal', 'Envolvimento em caso de desaparecimento'),
  ('Fernando Reis', 52, 'Masculino', 'Arcada com desgaste acentuado', 'Sobrevivente identificado posteriormente');

-- Inserir configurações iniciais do sistema
INSERT INTO configuracoes (chave, valor) VALUES
  ('tema_sistema', '{"tema": "escuro"}'),
  ('limite_upload', '{"tamanho_maximo": "25MB"}'),
  ('idioma_padrao', '{"idioma": "pt-BR"}'),
  ('notificacoes_email', '{"ativado": true}'),
  ('exibir_dicas', '{"mostrar": false}');

